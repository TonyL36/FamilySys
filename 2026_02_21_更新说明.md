## 1. 更新概述
- 新增后端 user 副本并配置独立用户密钥
- 后端鉴权支持管理员/用户双密钥
- 用户后端启用只读限制，阻止写入接口
- 用户后端端口调整为 8001，解决多后端冲突
- 用户前端统一切换为用户密钥与新端口访问

## 2. 目录与密钥
- 后端管理员：e:\GitProjects\MyProject\FamilySys\family-backend-admin（保持原密钥）
- 后端用户：e:\GitProjects\MyProject\FamilySys\family-backend-user（用户密钥：geUDpiPcALu/hC5YlgPM8MUcBTfTnhdCKN02fTICx7c=）
- 前端用户：e:\GitProjects\MyProject\FamilySys\family-frontend-user（已更新为用户密钥）

## 3. 后端变更
- family-backend：鉴权支持双密钥（管理员/用户）
- family-backend-admin：鉴权支持双密钥（管理员/用户）
- family-backend-user：
  - security.apiKey 设置为用户密钥
  - security.readOnly=true，非 GET/OPTIONS 请求返回 403
  - server.port=8001

### 3.1 后端鉴权双密钥（family-backend / family-backend-admin）
```properties
server.port=8000
security.apiKey=YLqWKfriSzxY4p2MTYjXEa63km86v9O6W4LoEOEM8vuXR7leJ9LZSr0g0Dafq_Dw
security.userApiKey=geUDpiPcALu/hC5YlgPM8MUcBTfTnhdCKN02fTICx7c=
```

```java
String adminKey = prop.getProperty("security.apiKey", "");
String userKey = prop.getProperty("security.userApiKey", "");
apiKeys = Arrays.stream(new String[]{adminKey, userKey})
        .map(String::trim)
        .filter(s -> !s.isEmpty())
        .collect(Collectors.toSet());
```

### 3.2 用户后端只读限制与端口（family-backend-user）
```properties
server.port=8001
security.apiKey=geUDpiPcALu/hC5YlgPM8MUcBTfTnhdCKN02fTICx7c=
security.readOnly=true
```

```java
readOnly = Boolean.parseBoolean(prop.getProperty("security.readOnly", "false"));
if (readOnly && !"GET".equalsIgnoreCase(exchange.getRequestMethod())) {
    byte[] payload = "{\"error\":\"Forbidden\"}".getBytes();
    exchange.getResponseHeaders().add("Content-Type", "application/json; charset=utf-8");
    exchange.sendResponseHeaders(403, payload.length);
    exchange.getResponseBody().write(payload);
    exchange.close();
    return;
}
```

## 4. 前端变更（用户端）
- 将用户前端页面的 API_BASE_URL 与 API_KEY 统一为用户后端配置
- 影响页面：
  - members2.html
  - relationships4.html
  - family-tree-final.html
  - distant-relative.html
  - kinship-network.html
  - pictureMap.html
  - family-tree2.html
  - family-tree.html
  - relationship3.html
  - relationships2.html
  - relationships.html

### 4.1 用户前端调用示例
```javascript
const API_BASE_URL = 'http://127.0.0.1:8001';
const API_KEY = 'geUDpiPcALu/hC5YlgPM8MUcBTfTnhdCKN02fTICx7c=';
```

## 5. 验证与测试
- family-backend：mvn clean compile、mvn test 通过
- family-backend-admin：mvn clean compile、mvn test 通过
- family-backend-user：mvn clean compile、mvn test 通过
