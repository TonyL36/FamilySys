# 2026å¹´2æœˆ13æ—¥ FamilySys éƒ¨ç½²æŠ€æœ¯æ€»ç»“

**æ—¥æœŸ**ï¼š2026-02-13  
**æ‰§è¡Œäºº**ï¼šTrae (ä»£è¡¨ç”¨æˆ·)  
**éƒ¨ç½²ç¯å¢ƒ**ï¼šé˜¿é‡Œäº‘ ECS (Ubuntu 24.04 LTS)  
**é¡¹ç›®çŠ¶æ€**ï¼šå·²éƒ¨ç½²ï¼Œå‰åç«¯è”è°ƒé€šè¿‡

---

## 1. éƒ¨ç½²æ¶æ„æ¦‚è¿°

æœ¬æ¬¡éƒ¨ç½²å°† FamilySys ç³»ç»Ÿåˆ†ä¸ºå‰åç«¯åˆ†ç¦»æ¶æ„ï¼š

*   **åç«¯ (Backend)**ï¼š
    *   **æŠ€æœ¯æ ˆ**ï¼šJava (JDK 17), SQLite, Maven (Shade Plugin)
    *   **è¿è¡Œæ–¹å¼**ï¼šSystemd æœåŠ¡å®ˆæŠ¤ (`familysys.service`)
    *   **ç›‘å¬ç«¯å£**ï¼š8000 (HTTP)
    *   **éƒ¨ç½²ä½ç½®**ï¼š`/opt/familysys`

*   **å‰ç«¯ (Frontend)**ï¼š
    *   **æŠ€æœ¯æ ˆ**ï¼šåŸç”Ÿ HTML5 / JavaScript (ES6+ Fetch API)
    *   **è¿è¡Œæ–¹å¼**ï¼šNginx é™æ€ç«™ç‚¹æ‰˜ç®¡
    *   **ç›‘å¬ç«¯å£**ï¼š80 (HTTP)
    *   **éƒ¨ç½²ä½ç½®**ï¼š`/var/www/familysys-frontend/family-frontend-remote`

---

## 2. å…³é”®é…ç½®è¯¦æƒ…

### 2.1 åç«¯æœåŠ¡é…ç½®
æˆ‘åˆ›å»ºäº† Systemd æœåŠ¡æ–‡ä»¶ä»¥ç¡®ä¿åç«¯å¼€æœºè‡ªå¯å’Œå´©æºƒè‡ªåŠ¨é‡å¯ã€‚

*   **æœåŠ¡æ–‡ä»¶**ï¼š`/etc/systemd/system/familysys.service`
*   **å…³é”®æŒ‡ä»¤**ï¼š
    ```ini
    [Service]
    WorkingDirectory=/opt/familysys
    ExecStart=/usr/bin/java -jar /opt/familysys/family-backend-1.0-SNAPSHOT.jar
    Restart=on-failure
    ```
*   **å®‰å…¨æœºåˆ¶**ï¼š
    *   å®ç°äº† `X-API-Key` è¯·æ±‚å¤´éªŒè¯ã€‚
    *   CORS é…ç½®å…è®¸è·¨åŸŸè®¿é—®ï¼ˆå·²æ·»åŠ  `Access-Control-Allow-Headers: X-API-Key`ï¼‰ã€‚

### 2.2 å‰ç«¯ Nginx é…ç½®
æˆ‘é…ç½®äº† Nginx ä½œä¸ºé™æ€æ–‡ä»¶æœåŠ¡å™¨ï¼ŒæŒ‡å‘ä¸“é—¨ä¸ºè¿œç¨‹ç¯å¢ƒå‡†å¤‡çš„ `family-frontend-remote` ç›®å½•ã€‚

*   **ç«™ç‚¹é…ç½®**ï¼š`/etc/nginx/sites-available/familysys-frontend`
*   **å…³é”®æŒ‡ä»¤**ï¼š
    ```nginx
    server {
        listen 80;
        root /var/www/familysys-frontend/family-frontend-remote;
        index family-tree-final.html;
        location / {
            try_files $uri $uri/ /family-tree-final.html;
        }
    }
    ```

---

## 3. é£é™©éšæ‚£æ’æŸ¥æŠ¥å‘Š (Risk Assessment)

åœ¨æäº¤ä»£ç å‰ï¼Œæˆ‘æ£€æŸ¥äº†æ ¸å¿ƒé€»è¾‘ï¼Œå‘ç°ä»¥ä¸‹æ½œåœ¨é£é™©ï¼Œå»ºè®®åç»­ä¼˜åŒ–ï¼š

### 3.1 ğŸ”´ æ•°æ®æŒä¹…åŒ–é£é™© (é«˜å±)
**é—®é¢˜æè¿°**ï¼š
åœ¨ `DatabaseConnection.java` ä¸­ï¼Œå½“ç¨‹åºä»¥ JAR åŒ…è¿è¡Œæ—¶ï¼Œä»£ç é€»è¾‘ä¼šæ£€æµ‹åˆ°æ•°æ®åº“æ–‡ä»¶ä½äº JAR å†…éƒ¨èµ„æºä¸­ (`resource.getProtocol().equals("jar")`)ã€‚æ­¤æ—¶ä»£ç ä¼šå°†å…¶å¤åˆ¶åˆ°**ä¸´æ—¶ç›®å½•** (`Files.createTempFile`) å¹¶åœ¨é€€å‡ºæ—¶åˆ é™¤ (`temp.toFile().deleteOnExit()`)ã€‚

```java
// DatabaseConnection.java é£é™©ä»£ç ç‰‡æ®µ
Path temp = Files.createTempFile("family", ".db");
Files.copy(in, temp, StandardCopyOption.REPLACE_EXISTING);
temp.toFile().deleteOnExit(); // <--- å¯¼è‡´æ•°æ®æ— æ³•æŒä¹…åŒ–
```

**åæœ**ï¼šæ¯æ¬¡é‡å¯åç«¯æœåŠ¡ï¼ˆ`systemctl restart familysys` æˆ–æœåŠ¡å™¨é‡å¯ï¼‰ï¼Œ**æ‰€æœ‰æ–°æ·»åŠ çš„æˆå‘˜å’Œå…³ç³»æ•°æ®éƒ½ä¼šä¸¢å¤±**ï¼Œç³»ç»Ÿä¼šé‡ç½®ä¸ºåˆå§‹çŠ¶æ€ã€‚

**å»ºè®®æ–¹æ¡ˆ**ï¼š
ä¿®æ”¹é€»è¾‘ï¼Œä¼˜å…ˆåœ¨ `WorkingDirectory` (å³ `/opt/familysys`) æŸ¥æ‰¾ `family.db`ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œæ‰ä» JAR åŒ…å¤åˆ¶ä¸€ä»½åˆ°è¯¥ç›®å½•ï¼ˆè€Œä¸æ˜¯ä¸´æ—¶ç›®å½•ï¼‰ï¼Œå¹¶ä½¿ç”¨è¯¥æ–‡ä»¶ä½œä¸ºæŒä¹…åŒ–å­˜å‚¨ã€‚

### 3.2 ğŸŸ  ç¡¬ç¼–ç é…ç½® (ä¸­é£é™©)
**é—®é¢˜æè¿°**ï¼š
å‰ç«¯æ‰€æœ‰ HTML æ–‡ä»¶ä¸­å‡ç¡¬ç¼–ç äº†åç«¯ IP å’Œ API Keyï¼š
```javascript
const API_BASE_URL = 'http://47.109.193.180:8000';
const API_KEY = 'YLqWKfriSzxY4p2...';
```

**åæœ**ï¼š
1.  **ç»´æŠ¤å›°éš¾**ï¼šå¦‚æœæœåŠ¡å™¨ IP å˜æ›´æˆ– API Key è½®æ¢ï¼Œéœ€è¦ä¿®æ”¹æ‰€æœ‰å‰ç«¯æ–‡ä»¶ã€‚
2.  **å®‰å…¨éšæ‚£**ï¼šAPI Key æš´éœ²åœ¨å‰ç«¯æºç ä¸­ï¼Œè™½ç„¶æ˜¯åªè¯»åº”ç”¨å¸¸è§åšæ³•ï¼Œä½†é…åˆ HTTP æ˜æ–‡ä¼ è¾“ï¼Œææ˜“è¢«æ‹¦æˆªã€‚

**å»ºè®®æ–¹æ¡ˆ**ï¼š
æå–é…ç½®åˆ°å•ç‹¬çš„ `config.js` æ–‡ä»¶ï¼Œå¹¶åœ¨éƒ¨ç½²æµæ°´çº¿ä¸­åŠ¨æ€æ³¨å…¥ç¯å¢ƒå˜é‡ã€‚

### 3.3 ğŸŸ  HTTP æ˜æ–‡ä¼ è¾“ (ä¸­é£é™©)
**é—®é¢˜æè¿°**ï¼š
å½“å‰æœåŠ¡è¿è¡Œåœ¨ HTTP (80/8000) ä¸Šï¼Œæœªå¯ç”¨ HTTPS/SSLã€‚

**åæœ**ï¼š
æ•°æ®ï¼ˆåŒ…æ‹¬ API Keyï¼‰åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æœªåŠ å¯†ï¼Œå®¹æ˜“å—åˆ°ä¸­é—´äººæ”»å‡»ã€‚

**å»ºè®®æ–¹æ¡ˆ**ï¼š
é…ç½® Nginx åå‘ä»£ç†åç«¯ï¼Œå¹¶ç”³è¯· SSL è¯ä¹¦ï¼ˆå¦‚ Let's Encryptï¼‰ï¼Œå¼ºåˆ¶å…¨ç«™ HTTPSã€‚

---

## 4. ç»“è®º

ç³»ç»Ÿå·²æˆåŠŸéƒ¨ç½²å¹¶å¯è®¿é—®ã€‚åŸºç¡€åŠŸèƒ½ï¼ˆæˆå‘˜ç®¡ç†ã€å…³ç³»æŸ¥è¯¢ã€æ—è°±å±•ç¤ºï¼‰åœ¨å½“å‰ç¯å¢ƒä¸‹è¿è¡Œæ­£å¸¸ã€‚ä½†**æ•°æ®æŒä¹…åŒ–é—®é¢˜**æ˜¯ç›®å‰æœ€å¤§çš„ç¨³å®šæ€§éšæ‚£ï¼Œå»ºè®®åœ¨æŠ•å…¥æ­£å¼ä½¿ç”¨å‰ä¼˜å…ˆä¿®å¤ `DatabaseConnection.java` çš„é€»è¾‘ã€‚
